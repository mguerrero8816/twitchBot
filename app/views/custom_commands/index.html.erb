<table class="table">
  <thead class="hidden" data-expandable="new-command">
    <tr>
      <th>Command</th>
      <th>Response</th>
      <th>Permission</th>
      <th></th>
    </tr>
  </thead>
  <tbody class="hidden" data-expandable="new-command">
    <tr class="js-form-fields-container">
      <td>!<%= text_field_tag 'custom_command[command]' %></td>
      <td><%= text_area_tag 'custom_command[response]' %></td>
      <td><%= select_tag 'custom_command[permission_id]', permission_options_for_select %></td>
      <td class="js-form-container">
        <%= form_tag custom_commands_path do %>
          <%= hidden_field_tag 'custom_command[channel_id]', current_channel.id %>
        <% end %>
        <span class="fake-link js-submit-form">Create</span>
        <span>|</span>
        <span class="fake-link expander" data-expander="new-command">Cancel</span>
      </td>
    </tr>
  </tbody>
  <tbody>
    <tr data-expandable="new-command">
      <td colspan="4">
        <span class="fake-link expander" data-expander="new-command">New Command</span>
      </td>
    </tr>
  </tbody>
  <thead>
    <tr>
      <th>Command</th>
      <th>Response</th>
      <th>Permission</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @custom_commands.each do |custom_command| %>
      <tr data-expandable="command-<%= custom_command.id %>">
        <td>!<%= custom_command.command %></td>
        <td><%= custom_command.response %></td>
        <td><%= CommandPermission::PERMISSIONS[custom_command.command_permission_id] %></td>
        <td>
          <span class="fake-link expander" data-expander="command-<%= custom_command.id %>">Edit</span>
          <span>|</span>
          <%= link_to 'Delete', custom_command_path(custom_command.id), method: :delete, data: { confirm: 'Are you sure?' } %>
        </td>
      </tr>
      <tr class="hidden js-form-fields-container" data-expandable="command-<%= custom_command.id %>">
        <td>!<%= text_field_tag 'custom_command[command]', custom_command.command %></td>
        <td><%= text_area_tag 'custom_command[response]', custom_command.response %></td>
        <td><%= select_tag 'custom_command[permission_id]', permission_options_for_select(custom_command.permission_id) %></td>
        <td class="js-form-container">
          <%= form_tag custom_command_path(id: custom_command.id), method: :put do %>
            <%= hidden_field_tag 'custom_command[channel_id]', current_channel.id %>
          <% end %>
          <span class="fake-link js-submit-form">Update</span>
          <span>|</span>
          <span class="fake-link expander" data-expander="command-<%= custom_command.id %>">Cancel</span>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<script type="text/javascript">
  $(document).ready(function(){
    bindExpanders()
    bindJsFormSubmitters()
  })
</script>
